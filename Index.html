<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hotel PMS Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .hidden { display: none; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background-color: #f2f2f2; }
  input, select, button { padding: 5px; margin: 5px 0; }
  nav button { margin-right: 10px; }
</style>
</head>
<body>

<h1>Hotel PMS</h1>

<!-- Login Section -->
<section id="loginSection">
  <h2>Login</h2>
  <form id="loginForm">
    Username: <input type="text" id="username" required><br>
    Password: <input type="password" id="password" required><br>
    <button type="submit">Login</button>
  </form>
  <p id="loginError" style="color:red;"></p>
</section>

<!-- Dashboard Section -->
<section id="dashboardSection" class="hidden">
  <h2>Welcome, <span id="userName"></span> (<span id="userRole"></span>)</h2>
  <button onclick="logout()">Logout</button>
  <nav>
    <button onclick="showSection('roomsSection')">Rooms</button>
    <button onclick="showSection('guestsSection')">Guests</button>
    <button onclick="showSection('bookingsSection')">Bookings</button>
    <button onclick="showSection('analyticsSection')">Analytics</button>
  </nav>

  <!-- Rooms -->
  <section id="roomsSection">
    <h3>Rooms</h3>
    <form id="roomForm">
      Number: <input type="text" id="roomNumber" required>
      Type: <input type="text" id="roomType" required>
      Status: 
      <select id="roomStatus">
        <option value="available">Available</option>
        <option value="occupied">Occupied</option>
        <option value="maintenance">Maintenance</option>
      </select>
      <button type="submit">Add Room</button>
    </form>
    <table id="roomsTable">
      <thead><tr><th>ID</th><th>Number</th><th>Type</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Guests -->
  <section id="guestsSection" class="hidden">
    <h3>Guests</h3>
    <form id="guestForm">
      Name: <input type="text" id="guestName" required>
      Email: <input type="email" id="guestEmail" required>
      Phone: <input type="text" id="guestPhone" required>
      <button type="submit">Add Guest</button>
    </form>
    <table id="guestsTable">
      <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Phone</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Bookings -->
  <section id="bookingsSection" class="hidden">
    <h3>Bookings</h3>
    <form id="bookingForm">
      Guest ID: <input type="number" id="bookingGuestId" required>
      Room ID: <input type="number" id="bookingRoomId" required>
      Check-in: <input type="date" id="checkIn" required>
      Check-out: <input type="date" id="checkOut" required>
      <button type="submit">Add Booking</button>
    </form>
    <table id="bookingsTable">
      <thead><tr><th>ID</th><th>Guest ID</th><th>Room ID</th><th>Check-in</th><th>Check-out</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Analytics -->
  <section id="analyticsSection" class="hidden">
    <h3>Analytics</h3>
    <p>Total Rooms: <span id="totalRooms"></span></p>
    <p>Occupied Rooms: <span id="occupiedRooms"></span></p>
    <p>Total Guests: <span id="totalGuests"></span></p>
    <p>Total Bookings: <span id="totalBookings"></span></p>
  </section>
</section>

<script>
const API_BASE = 'http://localhost:8000'; // change to your backend
let token = '';
let currentUser = null;

function showSection(id) {
  document.querySelectorAll('#dashboardSection section').forEach(sec => sec.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

async function login(username, password) {
  try {
    const res = await fetch(`${API_BASE}/login`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({username, password})
    });
    if (!res.ok) throw new Error('Invalid credentials');
    const data = await res.json();
    token = data.access_token;
    await loadCurrentUser();
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('dashboardSection').classList.remove('hidden');
    fetchRooms(); fetchGuests(); fetchBookings(); loadAnalytics();
  } catch (err) {
    document.getElementById('loginError').innerText = err.message;
  }
}

async function loadCurrentUser() {
  const res = await fetch(`${API_BASE}/me`, {
    headers: { 'Authorization': `Bearer ${token}` }
  });
  currentUser = await res.json();
  document.getElementById('userName').innerText = currentUser.name;
  document.getElementById('userRole').innerText = currentUser.role;
}

function logout() {
  token = '';
  currentUser = null;
  document.getElementById('dashboardSection').classList.add('hidden');
  document.getElementById('loginSection').classList.remove('hidden');
  document.getElementById('loginForm').reset();
}

// --------- LOGIN FORM ----------
document.getElementById('loginForm').addEventListener('submit', e => {
  e.preventDefault();
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  login(username, password);
});

// --------- ROOMS ----------
async function fetchRooms() {
  const res = await fetch(`${API_BASE}/rooms/`, {headers: {'Authorization': `Bearer ${token}`}});
  const rooms = await res.json();
  const tbody = document.getElementById('roomsTable').querySelector('tbody');
  tbody.innerHTML = '';
  rooms.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.number}</td><td>${r.type}</td><td>${r.status}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('roomForm').addEventListener('submit', async e => {
  e.preventDefault();
  const room = {
    number: document.getElementById('roomNumber').value,
    type: document.getElementById('roomType').value,
    status: document.getElementById('roomStatus').value
  };
  await fetch(`${API_BASE}/rooms/`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
    body: JSON.stringify(room)
  });
  fetchRooms();
  e.target.reset();
});

// --------- GUESTS ----------
async function fetchGuests() {
  const res = await fetch(`${API_BASE}/guests/`, {headers: {'Authorization': `Bearer ${token}`}});
  const guests = await res.json();
  const tbody = document.getElementById('guestsTable').querySelector('tbody');
  tbody.innerHTML = '';
  guests.forEach(g => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${g.id}</td><td>${g.name}</td><td>${g.email}</td><td>${g.phone}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('guestForm').addEventListener('submit', async e => {
  e.preventDefault();
  const guest = {
    name: document.getElementById('guestName').value,
    email: document.getElementById('guestEmail').value,
    phone: document.getElementById('guestPhone').value
  };
  await fetch(`${API_BASE}/guests/`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
    body: JSON.stringify(guest)
  });
  fetchGuests();
  e.target.reset();
});

// --------- BOOKINGS ----------
async function fetchBookings() {
  const res = await fetch(`${API_BASE}/bookings/`, {headers: {'Authorization': `Bearer ${token}`}});
  const bookings = await res.json();
  const tbody = document.getElementById('bookingsTable').querySelector('tbody');
  tbody.innerHTML = '';
  bookings.forEach(b => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${b.id}</td><td>${b.guest_id}</td><td>${b.room_id}</td><td>${b.check_in}</td><td>${b.check_out}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('bookingForm').addEventListener('submit', async e => {
  e.preventDefault();
  const booking = {
    guest_id: parseInt(document.getElementById('bookingGuestId').value),
    room_id: parseInt(document.getElementById('bookingRoomId').value),
    check_in: document.getElementById('checkIn').value,
    check_out: document.getElementById('checkOut').value
  };
  await fetch(`${API_BASE}/bookings/`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${token}`},
    body: JSON.stringify(booking)
  });
  fetchBookings();
  e.target.reset();
});

// --------- ANALYTICS ----------
async function loadAnalytics() {
  const roomsRes = await fetch(`${API_BASE}/rooms/`, {headers: {'Authorization': `Bearer ${token}`}});
  const bookingsRes = await fetch(`${API_BASE}/bookings/`, {headers: {'Authorization': `Bearer ${token}`}});
  const guestsRes = await fetch(`${API_BASE}/guests/`, {headers: {'Authorization': `Bearer ${token}`}});
  const rooms = await roomsRes.json();
  const bookings = await bookingsRes.json();
  const guests = await guestsRes.json();

  document.getElementById('totalRooms').innerText = rooms.length;
  document.getElementById('occupiedRooms').innerText = rooms.filter(r => r.status === 'occupied').length;
  document.getElementById('totalGuests').innerText = guests.length;
  document.getElementById('totalBookings').innerText = bookings.length;
</script>
</body>
</html>
